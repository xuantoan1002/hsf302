<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <meta charset="UTF-8">
    <title>Edit Discount Event</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <script th:src="@{/admin/js/plugin/webfont/webfont.min.js}"></script>
    <script>
        WebFont.load({
            google: {families: ["Public Sans:300,400,500,600,700"]},
            custom: {
                families: [
                    "Font Awesome 5 Solid",
                    "Font Awesome 5 Regular",
                    "Font Awesome 5 Brands",
                    "simple-line-icons"
                ],
                urls: ["/admin/css/fonts.min.css"]
            },
            active: function () {
                sessionStorage.fonts = true;
            }
        });
    </script>

    <link rel="stylesheet" th:href="@{/admin/css/bootstrap.min.css}"/>
    <link rel="stylesheet" th:href="@{/admin/css/plugins.min.css}"/>
    <link rel="stylesheet" th:href="@{/admin/css/kaiadmin.min.css}"/>
    <link rel="stylesheet" th:href="@{/admin/css/demo.css}"/>
</head>
<body>

<div class="wrapper">
    <div th:replace="/admin/fragment/sidebar :: sidebar"></div>

    <div class="main-panel">
        <div th:replace="/admin/fragment/header :: header"></div>

        <div class="form-wrapper">
            <div class="form-title">Edit Discount Event</div>

            <form th:action="@{/admin/discount/update/{id}(id=${id})}" th:object="${request}" method="post">
                <div class="form-group mb-3">
                    <label>Name</label>
                    <input type="text" th:field="*{name}" class="form-control rounded"/>
                    <div class="text-danger" th:if="${#fields.hasErrors('name')}" th:errors="*{name}"></div>
                </div>

                <div class="form-group mb-3">
                    <label>Start Date</label>
                    <input type="date" th:field="*{startDate}" class="form-control rounded"/>
                    <div class="text-danger" th:if="${#fields.hasErrors('startDate')}" th:errors="*{startDate}"></div>
                </div>

                <div class="form-group mb-3">
                    <label>End Date</label>
                    <input type="date" th:field="*{endDate}" class="form-control rounded"/>
                    <div class="text-danger" th:if="${#fields.hasErrors('endDate')}" th:errors="*{endDate}"></div>
                </div>

                <div class="form-group mb-3">
                    <label>Discount Type</label>
                    <select th:field="*{discountType}" class="form-select rounded">
                        <option value="" disabled>-- Select Type --</option>
                        <option th:value="PERCENT">Percent</option>
                        <option th:value="AMOUNT">Amount</option>
                    </select>
                    <div class="text-danger" th:if="${#fields.hasErrors('discountType')}" th:errors="*{discountType}"></div>
                </div>

                <div class="form-group mb-3">
                    <label>Discount Value</label>
                    <input type="number" th:field="*{discountValue}" class="form-control rounded" step="0.01"/>
                    <div class="text-danger" th:if="${#fields.hasErrors('discountValue')}" th:errors="*{discountValue}"></div>
                </div>

                <div class="form-group mb-3">
                    <label>Target Type</label>
                    <select th:field="*{targetType}" class="form-select rounded" id="target-type-select">
                        <option value="" disabled>-- Select Target --</option>
                        <option th:value="ALL">ALL</option>
                        <option th:value="PRODUCT">PRODUCT</option>
                    </select>
                </div>

                <div class="form-group mb-3" id="product-select-group">
                    <label>Product (optional)</label>
                    <select th:field="*{productId}" class="form-select rounded">
                        <option value="">-- Select Product --</option>
                        <option th:each="product : ${products}"
                                th:value="${product.id}"
                                th:text="${product.name}">
                        </option>
                    </select>
                    <div class="text-danger" th:if="${#fields.hasErrors('productId')}" th:errors="*{productId}"></div>
                </div>

                <div class="form-group mb-4">
                    <label>Note</label>
                    <textarea th:field="*{note}" class="form-control rounded" rows="3"></textarea>
                </div>

                <div class="d-flex justify-content-between">
                    <a th:href="@{/admin/discount/list}" class="btn btn-outline-secondary">Cancel</a>
                    <button type="submit" class="btn btn-primary">Update</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- JS Files -->
<script th:src="@{/admin/js/core/jquery-3.7.1.min.js}"></script>
<script th:src="@{/admin/js/core/popper.min.js}"></script>
<script th:src="@{/admin/js/core/bootstrap.min.js}"></script>
<script th:src="@{/admin/js/plugin/jquery-scrollbar/jquery.scrollbar.min.js}"></script>
<script th:src="@{/admin/js/plugin/datatables/datatables.min.js}"></script>
<script th:src="@{/admin/js/plugin/sweetalert/sweetalert.min.js}"></script>
<script th:src="@{/admin/js/kaiadmin.min.js}"></script>
<script th:src="@{/admin/js/demo.js}"></script>

<!-- Hide product select if Target Type is ALL -->
<script>
    function toggleProductSelect() {
        const targetType = document.getElementById('target-type-select').value;
        const productGroup = document.getElementById('product-select-group');
        productGroup.style.display = targetType === 'ALL' ? 'none' : 'block';
    }

    document.addEventListener('DOMContentLoaded', function () {
        const targetSelect = document.getElementById('target-type-select');
        targetSelect.addEventListener('change', toggleProductSelect);
        toggleProductSelect();
    });
</script>

</body>
</html>
